# Search GIFs with Litho and Giphy

Facebook recently released [Litho](http://fblitho.com/) - A declarative UI framework for Android. From what I have
heard, Litho is inspired by React. React has concept of components so that it can be easily reused and
rendered (with jsx). To follow that I have made some components.

![Screenshot](https://raw.githubusercontent.com/jayrambhia/LithoGifSearch/master/art/demo1.jpg)

## Components

### HomeComponent
HomeComponentSpec generates HomeComponent. It is the main view of MainActivity. To have views stacked
vertically, I'm using `Column`. Column comes from Yoga which is a cross platform layout engine with flexbox like
styling. This column contains two components.

 - EditText
 - RecyclerView

Since it was not really necessary to create a separate component for EditText at the moment, I have directly added
it in the column as a child. EditText is a litho widget which renders android's EditText. We need to listen to EditText
updates so I created an interface `onQueryUpdateListener` and passed it as a prop to HomeComponent. It has an `@OnEvent(TextChangedEvent.class)`
method which when hooked to `EditText.textChangedEventHandler()`, it will start giving you updates.

Even for the RecyclerView, we do not require a separate component but I have created it since I was doing some testing
with changing data dynamically.

### MyRecyclerView
It's sort of a component but I did not name it as one. Anyway, initially, I struggled a lot to update data
dynamically. I tried `@Prop` and `@State` and some combination of that but it did not work. There is no easy
way to update the state from outside (eg. Activity) because those methods are protected. You could add a static method
in your Spec class which would trigger state update but it requires a `ComponentContext` and you could pass it from activity
but it would not work because it doesn't have any component bound to it. There aren't many (or any) example
which would show how to update recyclerview's (adapter) data dynamically.

**RecyclerViewBinder**
It's not a component. RecyclerViewBinder is sort of super RecyclerViewAdapter which does a lot of the optimizations.
It has a method `insertItemAt(position, component)` using which you can add items in RecyclerView. So I moved the binder
out of MyRecyclerViewSpec and passed it as a prop. Now, since I have access to the binder, I can remove and add items
at will. So we do not even need States here.

### GifItemView
GifItemView is a component to display gifs. It is generated by `GifItemViewSpec`. This was the most difficult part of this app.
If you want to display an image, you can use litho's `Image` widget. It just takes a drawable. So it would be super difficult
to keep track of downloaded bitmaps and have state in the component and update it, oh and did I tell you that there isn't a direct
easy way to update states from outside? So I started digging into litho's sample code and they have used Fresco with some other
library. It should not be that difficult to display an image, right?

But then I noticed that they have used `@MountSpec` which is basically used for custom views and drawables. So I started looking
for some docs and examples but the only one they have of ColorDrawable is super easy and you can't even figure out the lifecycle
and how things are working. I mean, you can, of course, because I did. But after a lot of trial and errors.

[MountSpec doc](http://fblitho.com/docs/mount-specs). After reading through the fine print, I realized that I can return a View or
a Drawable in `@onCreateMountContent`. As the name suggests, you create a content to display. So anyway, after couple of hours,
I finally got it right. It now display GIFs.

## Conclusion
Wow, I have said too much. It's fun to work with Litho. The API is quite easy but there is some learning curve and
if you want customize it or have some weird states, you're in for a roll.

## Disclaimer
I do not (yet) fully understand Litho, States, Yoga, Flexbox so feel free to suggest updates and best practices.
